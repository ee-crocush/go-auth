# Cyberball Auth Service

**Cyberball Auth** — это сервис аутентификации для проекта Cyberball. 
Он предоставляет механизмы регистрации, входа,
обновления токенов и выхода для пользователей.

## Технологии

- **Go** — основной язык разработки.
- **gRPC** — механизм для создания RPC-сервисов.
- **PostgreSQL** — реляционная база данных для хранения данных.
- **JWT** — JSON Web Token для аутентификации пользователей.
- **Redis*** — для хранения сессий пользователей (описание будет позже).

### Используемые библиотеки
*Да, я знаю, что все это есть в go.mod, но это больше мне нужно)*

- **github.com/golang-jwt/jwt/v5** — библиотека для работы с JWT.
- **golang.org/x/crypto/bcrypt** — библиотека для работы с хешированием паролей.
- **github.com/golang-migrate/migrate/v4** — библиотека для работы с миграциями.
- **github.com/joho/godotenv** — библиотека для работы с переменными окружения.
- **github.com/ilyakaznacheev/cleanenv** — библиотека для работы с конфигурацией.
- **github.com/lib/pq** — библиотека для работы с PostgreSQL
- **google.golang.org/grpc** — библиотека для работы с gRPC.


## Структура проекта

Проект реализует **чистую архитектуру**, разделяя код на несколько слоев, 
что улучшает тестируемость, поддерживаемость и расширяемость. 
Структура проекта следующая:

### Корень проекта
- **cmd/app** — точка входа. Содержит файл `main.go`, который вызывает 
- функцию `Run` из файла `internal/app/app.go`.

- **config** — конфигурации проекта, включая параметры для работы с базой данных, 
аутентификацией и другими сервисами.
- **internal** — реализация чистой архитектуры, включая следующие слои:
  - **adapter** — взаимодействует с внешними системами и сервисами
  - **app** — слой, который управляет взаимодействием между контроллерами, use case и репозиториями. В нем содержатся бизнес-логика и сервисы.
  - **controller** — обрабатывает входящие запросы и передает их в слой `usecase` 
  для дальнейшей обработки. В этом проекте используется gRPC для обработки запросов.
  - **entity** — модели данных, представляющие бизнес-объекты, которые используются 
  в других слоях, такие как пользователь.
  - **usecase** — бизнес-логика, которая инкапсулирует правила обработки данных и 
  выполнения операций, таких как аутентификация и управление сессиями.
  - **repo** — слой для работы с базой данных. В этом проекте используется PostgreSQL через 
  драйвер `lib/pq` для взаимодействия с хранилищем данных.

**Для взаимодействия с redis описание в разработке*

## Установка

### 1. Клонирование репозитория

Для начала, клонируйте репозиторий:

```bash
git clone git@gitlab.dev-api.tech:cyberball/auth.git
```

### 2. Установка зависимостей

Перейдите в папку проекта и установите все зависимости:

```bash
go mod tidy
```

### 3. Настройка конфигурации

Создайте файл конфигурации: *config/config.yaml*\
В корне проекта добавьте свой *.env* файл. Пример приложен

### 4. Запуск проекта

Чтобы запустить сервис, выполните команду:

```bash
go run cmd/main.go
```

Пока ничего не заработает, это так и запланировано

## Технология JWT (JSON Web Tokens)

Для аутентификации и авторизации в сервисе используется JWT. JWT позволяет безопасно передавать информацию между
клиентом и сервером в виде токенов.
- Access Token — короткоживущий токен, используемый для подтверждения аутентификации пользователя.
- Refresh Token — долгоживущий токен, используемый для получения нового access token, когда старый истекает.

### Пример работы с токенами
1. Пользователь регистрируется или входит в систему. 
2. Сервер генерирует два токена:
- access_token (для доступа к защищённым маршрутам).
- refresh_token (для обновления access token).
3. Токены передаются клиенту, который использует их для аутентификации при последующих запросах.

## Тестирование
Для запуска тестов используйте команду:

```bash
go test ./...
```
